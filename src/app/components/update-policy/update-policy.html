
<div class="container">
  <div class="card">
    <h2>Update Policy</h2>
    
    @if (isLoading()) {
      <div class="loading-state">
        <div class="spinner"></div>
        <p>Loading policy...</p>
      </div>
    } @else {
      @if (submitSuccess()) {
        <div class="alert alert-success">
          âœ“ Policy updated successfully! Redirecting...
        </div>
      }
      
      @if (submitError()) {
        <div class="alert alert-error">
          {{ submitError() }}
        </div>
      }
      
      <form [formGroup]="policyForm" (ngSubmit)="onSubmit()">
        <div class="form-group">
          <label>Policy Number: <span class="required">*</span></label>
          <input 
            type="text" 
            formControlName="policyNumber" 
            placeholder="e.g., POL001"
            [class.error]="policyNumber?.invalid && policyNumber?.touched">
          @if (policyNumber?.invalid && policyNumber?.touched) {
            <div class="error-message">
              @if (policyNumber?.errors?.['required']) {
                Policy number is required
              }
              @if (policyNumber?.errors?.['pattern']) {
                Format: 3 letters + 3 digits (e.g., POL001)
              }
            </div>
          }
        </div>

        <div class="form-group">
          <label>Policy Holder Name: <span class="required">*</span></label>
          <input 
            type="text" 
            formControlName="policyHolderName"
            [class.error]="policyHolderName?.invalid && policyHolderName?.touched">
          @if (policyHolderName?.invalid && policyHolderName?.touched) {
            <div class="error-message">
              @if (policyHolderName?.errors?.['required']) {
                Name is required
              }
              @if (policyHolderName?.errors?.['minlength']) {
                Name must be at least 3 characters
              }
            </div>
          }
        </div>

        <div class="form-group">
          <label>Policy Type: <span class="required">*</span></label>
          <select formControlName="policyType"
                  [class.error]="policyType?.invalid && policyType?.touched">
            <option value="">Select Type</option>
            @for (type of policyTypes(); track type) {
              <option [value]="type">{{ type }}</option>
            }
          </select>
          @if (policyType?.invalid && policyType?.touched) {
            <div class="error-message">Policy type is required</div>
          }
        </div>

        <div class="form-group">
          <label>Premium ($): <span class="required">*</span></label>
          <input 
            type="number" 
            formControlName="premium"
            [class.error]="premium?.invalid && premium?.touched">
          @if (premium?.invalid && premium?.touched) {
            <div class="error-message">
              @if (premium?.errors?.['required']) {
                Premium is required
              }
              @if (premium?.errors?.['min']) {
                Premium must be greater than 0
              }
            </div>
          }
        </div>

        <div class="form-group">
          <label>Start Date: <span class="required">*</span></label>
          <input 
            type="date" 
            formControlName="startDate"
            [class.error]="startDate?.invalid && startDate?.touched">
          @if (startDate?.invalid && startDate?.touched) {
            <div class="error-message">Start date is required</div>
          }
        </div>

        <div class="form-group">
          <label>End Date: <span class="required">*</span></label>
          <input 
            type="date" 
            formControlName="endDate"
            [class.error]="endDate?.invalid && endDate?.touched">
          @if (endDate?.invalid && endDate?.touched) {
            <div class="error-message">End date is required</div>
          }
        </div>

        <div class="form-group">
          <label>Status: <span class="required">*</span></label>
          <select formControlName="status">
            @for (stat of statuses(); track stat) {
              <option [value]="stat">{{ stat }}</option>
            }
          </select>
        </div>

        <div class="button-group">
          <button 
            type="submit" 
            class="btn btn-primary" 
            [disabled]="policyForm.invalid || isSubmitting()">
            @if (isSubmitting()) {
              <span>Updating...</span>
            } @else {
              <span>Update Policy</span>
            }
          </button>
          <button 
            type="button" 
            class="btn btn-secondary" 
            routerLink="/view-policies"
            [disabled]="isSubmitting()">
            Cancel
          </button>
        </div>
      </form>
    }
  </div>
</div>
